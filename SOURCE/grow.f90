!======================================================================!
SUBROUTINE grow
!----------------------------------------------------------------------!
! Update an individual tree.
!----------------------------------------------------------------------!
USE CONSTANTS
USE CONTROL
USE TREE
!----------------------------------------------------------------------!
IMPLICIT NONE
!----------------------------------------------------------------------!

DO I = 1, NIND_alive
KI = LIVING (I)

!----------------------------------------------------------------------!
! fPAR is the fraction of total PAR incident on the plot that is
! absorbed by the individual.
!----------------------------------------------------------------------!
GPP   = 10.0e-6 * fPAR (KI) ! Crown gross photosynthesis    (umol/m^2/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Following just nudges trees so they do not all grow the same.
!----------------------------------------------------------------------!
CALL RANDOM_NUMBER (RANDOM)
!----------------------------------------------------------------------!
GPP = GPP * (0.9 + RANDOM / 5.0)
!----------------------------------------------------------------------!
Resp  = 0.5 * GPP ! Maintenance respiration                 (umol/m^2/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Net tree C uptake (kgC/tree/s).
!----------------------------------------------------------------------!
Cup = KGCPERMOL * Acrown (KI) * (GPP - Resp)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
tau = 100.0 * FLOAT (EDPERY * SPERED) ! Structural C residence time  (s)
Clit = Cv (KI) / tau  ! Structural litter flux               (kgC/tree/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
dCV = Cup - Clit ! Structural carbon time derivative        (kgC/tree/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
Cv (KI) = Cv (KI) + DTTR * dCv
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Accumulate annual diagnostics.
!----------------------------------------------------------------------!
NPP_ann_acc = NPP_ann_acc + DTTR * Cup / (Aplot + EPS)
!----------------------------------------------------------------------!

END DO ! KI = 1, NIND_alive

!----------------------------------------------------------------------!
END SUBROUTINE grow
!======================================================================!
